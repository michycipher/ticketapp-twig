{% extends "layout.twig" %}
{% block body %}
	<div class="my-14 max-w-[1440px] mx-auto px-6">
		<h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">
			{{ action == 'create' ? 'Create Ticket' : 'Edit Ticket' }}
		</h2>

		<div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-md border border-gray-200">
			{% if errors %}
				{# <div class="mb-6 text-red-600 space-y-1">
								          {% for k, e in errors %}
								            <div class="text-sm">{{ e }}</div>
								          {% endfor %}
								        </div> #}
				<div class="fixed top-6 left-1/2 transform -translate-x-1/2 z-50">
					<div class="bg-green-500 text-white px-6 py-3 rounded shadow-lg animate-fade-out">
						{{ flash }}
					</div>
				</div>


			{% endif %}

			<form method="post" novalidate class="space-y-6">
				<div>
					<label class="block text-sm font-medium text-gray-700">Title</label>
					<input name="title" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500" value="{{ old.title|default('') }}"/>
				</div>

				<div>
					<label class="block text-sm font-medium text-gray-700">Status</label>
					<select name="status" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500">
						<option value="">Select status</option>
						<option value="open" {{ old.status == 'open' ? 'selected' : '' }}>Open</option>
						<option value="in_progress" {{ old.status == 'in_progress' ? 'selected' : '' }}>In Progress</option>
						<option value="closed" {{ old.status == 'closed' ? 'selected' : '' }}>Closed</option>
					</select>
				</div>

				<div>
					<label class="block text-sm font-medium text-gray-700">Description (optional)</label>
					<textarea name="description" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500">{{ old.description|default('') }}</textarea>
				</div>

				<div class="flex items-center justify-start space-x-4 pt-4">
					<button type="submit" class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-md shadow hover:bg-indigo-700 transition">
						{{ action == 'create' ? 'Create' : 'Save' }}
					</button>
					<a href="/tickets" class="px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 transition">
						Cancel
					</a>
				</div>
			</form>
		</div>

		{# Ticket list #}

		{# {% if tickets %}
					<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mx-auto mt-12">
						<h3 class="text-xl font-bold text-gray-800 mb-4">All Tickets</h3>
						{% for t in tickets %}
							<div class="bg-white border border-gray-200 rounded-lg shadow p-4">
								<div class="flex justify-between items-center mb-2">
									<h4 class="text-lg font-semibold text-gray-800">{{ t.title }}</h4>
									<span class="text-xs px-2 py-1 rounded-full
											            {% if t.status == 'open' %}
											              bg-green-100 text-green-700
											            {% elseif t.status == 'in_progress' %}
											              bg-yellow-100 text-yellow-700
											            {% else %}
											              bg-gray-200 text-gray-600
											            {% endif %}
											          ">
										{{ t.status | capitalize }}
									</span>
								</div>
								<p class="text-sm text-gray-600">{{ t.description }}</p>
								<p class="text-xs text-gray-400 mt-2">Created:
									{{ t.created_at|date("M d, Y H:i") }}</p>
		
								<div class="mt-4 flex gap-3">
									<a href="/tickets/edit/{{ t.id }}" class="text-indigo-600 hover:underline text-sm">Edit</a>
									<a href="/tickets/delete/{{ t.id }}" class="text-red-600 hover:underline text-sm">Delete</a>
								</div>
							</div>
						{% endfor %}
					</div>
				{% endif %} #}

		{% if tickets %}
			<div class="mx-auto mt-12 px-4">
				<h3 class="text-xl font-bold text-gray-800 mb-6">All Tickets</h3>

				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
					{% for t in tickets %}
						<div class="bg-white border border-gray-200 rounded-lg shadow p-4">
							<div class="flex justify-between items-center mb-2">
								<h4 class="text-lg font-semibold text-gray-800">{{ t.title }}</h4>
								<span class="text-xs px-2 py-1 rounded-full
										              {% if t.status == 'open' %}
										                bg-green-100 text-green-700
										              {% elseif t.status == 'in_progress' %}
										                bg-yellow-100 text-yellow-700
										              {% else %}
										                bg-gray-200 text-gray-600
										              {% endif %}
										            ">
									{{ t.status | capitalize }}
								</span>
							</div>
							<p class="text-sm text-gray-600">{{ t.description }}</p>
							<p class="text-xs text-gray-400 mt-2">Created:
								{{ t.created_at|date("M d, Y H:i") }}</p>

							<div class="mt-4 flex gap-3">
								<a href="/tickets/edit/{{ t.id }}" class="text-indigo-600 hover:underline text-sm">Edit</a>
								<a href="/tickets/delete/{{ t.id }}" onclick="return confirm('Are you sure you want to delete this ticket?')" class="text-red-600 hover:underline text-sm">
									Delete
								</a>
							</div>
						</div>
					{% endfor %}
				</div>
			</div>
		{% endif %}
	</div>
{% endblock %}
